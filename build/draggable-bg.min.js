/*! 
 * draggable-bg v1.0.0-beta1
 * https://github.com/chieffancypants/angular-draggable-bg
 * Copyright (c) 2015 Wes Cruver
 * License: MIT
 */
!function(){"use strict";angular.module("chieffancypants.draggableBg",[]).directive("draggableBg",function(a,b){return{scope:{imgSrc:"=draggableBg",displayPosX:"=?draggableBgX",displayPosY:"=?draggableBgY",realTimeUpdate:"@draggableBgRealtime"},link:function(c,d){function e(){j=(d.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],p.src=j}function f(a,b){var d=b[0];m=c.displayPosX||Math.round((d.clientWidth-o.width)/2),n=c.displayPosY||Math.round((d.clientHeight-o.height)/2),b.css("background-position",m+"px "+n+"px"),c.displayPosX=m,c.displayPosY=n}function g(a,b,c,d){if(3===arguments.length||d){if(a>c)return Math.ceil(a);if(c>b)return Math.ceil(b)}return c}function h(a){n=a.pageY-l,n=g(d[0].clientHeight-o.height,0,n,!0),m=a.pageX-k,m=g(d[0].clientWidth-o.width,0,m,!0),d.css({backgroundPosition:m+"px "+n+"px"}),c.displayPosX=m,c.displayPosY=n,c.$eval(c.realTimeUpdate)&&c.$apply()}function i(){a.off("mousemove",h),a.off("mouseup",i),c.$apply(),b.$emit("draggableBg:repositioned",{x:c.displayPosX,y:c.displayPosY})}var j,k=0,l=0,m=0,n=0,o={width:0,height:0},p=new Image;c.$watch("imgSrc",function(a){d.css("background-image","url("+a+")"),d.addClass("draggable-bg"),e()}),d.on("mousedown",function(b){b.preventDefault(),k=b.pageX-m,l=b.pageY-n,a.on("mousemove",h),a.on("mouseup",i)}),p.onload=function(){var a=d[0],e=a.ownerDocument.defaultView.getComputedStyle(a,null)["background-size"],g=a.clientWidth,h=a.clientHeight;if("cover"===e){var i=g/h,j=p.width/p.height,k=1;k=j>=i?h/p.height:g/p.width,o.width=p.width*k,o.height=p.height*k}else o.width=p.width,o.height=p.height;f(c.moment,d),b.$broadcast("draggableBg:ready",{x:c.displayPosX,y:c.displayPosY})}}}})}();