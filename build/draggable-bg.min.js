/*! 
 * draggable-bg v1.0.0-beta2
 * https://github.com/chieffancypants/angular-draggable-bg
 * Copyright (c) 2015 Wes Cruver
 * License: MIT
 */
!function(){"use strict";angular.module("chieffancypants.draggableBg",[]).directive("draggableBg",function(a,b){return{scope:{imgSrc:"=draggableBg",displayPosX:"=?draggableBgX",displayPosY:"=?draggableBgY",realTimeUpdate:"@draggableBgRealtime"},link:function(c,d){function e(){p=(d.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],t.src=p}function f(a,b){b[0];q=c.displayPosX||q,r=c.displayPosY||r,b.css("background-position",q+"% "+r+"%"),c.displayPosX=q,c.displayPosY=r}function g(a,b,c,d){if(3===arguments.length||d){if(a>c)return Math.ceil(a);if(c>b)return Math.ceil(b)}return c}function h(a){var b=m-a.pageY;r=n+b*o,r=g(0,100,r,!0);var e=j-a.pageX;q=k+e*l,q=g(0,100,q,!0),d.css({backgroundPosition:q+"% "+r+"%"}),c.displayPosX=q,c.displayPosY=r,c.$eval(c.realTimeUpdate)&&c.$apply()}function i(){a.off("mousemove",h),a.off("mouseup",i),c.$apply(),b.$emit("draggableBg:repositioned",{x:c.displayPosX,y:c.displayPosY})}var j,k,l,m,n,o,p,q=50,r=50,s={width:0,height:0,scale:1},t=new Image;c.$watch("imgSrc",function(a){d.css("background-image","url("+a+")"),d.addClass("draggable-bg"),e()}),d.on("mousedown",function(b){b.preventDefault(),j=b.pageX,k=q,l=100/(s.width-d[0].clientWidth||1),m=b.pageY,n=r,o=100/(s.height-d[0].clientHeight||1),a.on("mousemove",h),a.on("mouseup",i)}),t.onload=function(){var a=d[0],e=a.ownerDocument.defaultView.getComputedStyle(a,null)["background-size"],g=a.clientWidth,h=a.clientHeight;if("cover"===e){var i=g/h,j=t.width/t.height;j>=i?s.scale=h/t.height:s.scale=g/t.width,s.width=t.width*s.scale,s.height=t.height*s.scale}else s.width=t.width,s.height=t.height;f(c.moment,d),b.$broadcast("draggableBg:ready",{x:c.displayPosX,y:c.displayPosY})}}}})}();